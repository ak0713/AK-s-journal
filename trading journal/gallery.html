<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ðŸ“¸ Trade Chart Gallery</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f7fb;
      color: #333;
    }

    h1 {
      text-align: center;
      margin: 30px 0;
      font-size: 2rem;
      color: #2a2e40;
    }

    .container {
      max-width: 1100px;
      margin: auto;
      padding: 20px;
    }

    .upload-container,
    .filter-container {
      background: white;
      padding: 20px;
      margin-bottom: 30px;
      border-radius: 15px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.05);
    }

    .upload-container input,
    .upload-container textarea,
    .upload-container select,
    .filter-container input,
    .filter-container select {
      width: 100%;
      margin-top: 10px;
      margin-bottom: 20px;
      padding: 10px 15px;
      font-size: 1em;
      border-radius: 10px;
      border: 1px solid #ccc;
    }

    .upload-container button,
    .filter-container button,
    .export-btn {
      padding: 10px 20px;
      font-size: 1em;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin-right: 10px;
      transition: 0.3s;
    }

    .upload-container button {
      background-color: #00b894;
      color: white;
    }

    .filter-container button {
      background-color: #0984e3;
      color: white;
    }

    .export-btn {
      display: block;
      margin: 20px auto;
      background-color: #6c5ce7;
      color: white;
    }

    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }

    .card {
      background: #ffffff;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      transition: transform 0.3s ease;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      cursor: pointer;
    }

    .card .info {
      padding: 15px;
    }

    .info p {
      margin: 5px 0;
      font-size: 0.95em;
    }

    .actions {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }

    .actions button {
      flex: 1;
      margin-right: 10px;
      padding: 8px;
      font-size: 0.9em;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: 0.3s;
    }

    .actions .edit-btn {
      background-color: #74b9ff;
      color: white;
    }

    .actions .delete-btn {
      background-color: #ff7675;
      color: white;
    }

    /* Modal Styles */
    #imageModal {
      display: none;
      position: fixed;
      z-index: 9999;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.85);
    }

    #imageModal img {
      max-width: 90%;
      max-height: 90%;
      display: block;
      margin: auto;
      position: relative;
      top: 50%;
      transform: translateY(-50%);
      border-radius: 12px;
    }

    #closeBtn, #prevBtn, #nextBtn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 40px;
      color: white;
      cursor: pointer;
      user-select: none;
    }

    #closeBtn {
      top: 20px;
      right: 30px;
      font-size: 30px;
      transform: none;
    }

    #prevBtn { left: 30px; }
    #nextBtn { right: 30px; }
  </style>
</head>
<body>

  <h1>ðŸ“ˆ Trade Chart Gallery</h1>
  <div class="container">

    <div class="upload-container">
      <input type="file" id="imageInput" accept="image/*" />
      <textarea id="noteInput" placeholder="Write a note for this trade..."></textarea>
      <select id="categoryInput">
        <option value="">Select Category</option>
        <option value="Profitable Trade">Profitable Trade</option>
        <option value="Mistake">Mistake</option>
        <option value="Others">Others</option>
      </select>
      <input type="date" id="dateInput" />
      <button onclick="uploadImage()">Upload</button>
    </div>

    <div class="filter-container">
      <label>From:</label>
      <input type="date" id="filterStartDate">
      <label>To:</label>
      <input type="date" id="filterEndDate">
      <label>Category:</label>
      <select id="filterCategory">
        <option value="">All</option>
        <option value="Profitable Trade">Profitable Trade</option>
        <option value="Mistake">Mistake</option>
        <option value="Others">Others</option>
      </select>
      <button onclick="applyFilters()">Apply</button>
      <button onclick="resetFilters()">Reset</button>
    </div>

    <button class="export-btn" onclick="exportToPDF()">ðŸ“„ Export All to PDF</button>

    <div class="gallery" id="gallery"></div>
  </div>

  <!-- Image Modal -->
  <div id="imageModal" onclick="closeImageModal()">
    <span id="closeBtn" onclick="closeImageModal()">&times;</span>
    <span id="prevBtn" onclick="prevImage(event)">&#10094;</span>
    <span id="nextBtn" onclick="nextImage(event)">&#10095;</span>
    <img id="modalImage" />
  </div>

  <script>
    let gallery = JSON.parse(localStorage.getItem("tradeGallery")) || [];
    let filteredGallery = [];
    let currentIndex = 0;

    function saveGallery() {
      localStorage.setItem("tradeGallery", JSON.stringify(gallery));
    }

    function uploadImage() {
      const file = document.getElementById("imageInput").files[0];
      const note = document.getElementById("noteInput").value;
      const category = document.getElementById("categoryInput").value;
      const date = document.getElementById("dateInput").value;

      if (!file || !note || !category || !date) {
        alert("Please fill in all fields.");
        return;
      }

      const reader = new FileReader();
      reader.onload = function (e) {
        gallery.push({ image: e.target.result, note, category, date });
        saveGallery();
        renderGallery();
        document.getElementById("imageInput").value = '';
        document.getElementById("noteInput").value = '';
        document.getElementById("categoryInput").value = '';
        document.getElementById("dateInput").value = '';
      };
      reader.readAsDataURL(file);
    }

    function deleteImage(index) {
      if (confirm("Delete this image?")) {
        gallery.splice(index, 1);
        saveGallery();
        renderGallery();
      }
    }

    function editNote(index) {
      const newNote = prompt("Edit note:", gallery[index].note);
      if (newNote !== null) {
        gallery[index].note = newNote;
        saveGallery();
        renderGallery();
      }
    }

    function applyFilters() {
      const startDate = document.getElementById("filterStartDate").value;
      const endDate = document.getElementById("filterEndDate").value;
      const category = document.getElementById("filterCategory").value;
      renderGallery(startDate, endDate, category);
    }

    function resetFilters() {
      document.getElementById("filterStartDate").value = '';
      document.getElementById("filterEndDate").value = '';
      document.getElementById("filterCategory").value = '';
      renderGallery();
    }

    function renderGallery(startDate = '', endDate = '', categoryFilter = '') {
      const galleryContainer = document.getElementById("gallery");
      galleryContainer.innerHTML = "";
      filteredGallery = [];

      gallery.forEach((item, index) => {
        if ((startDate && item.date < startDate) ||
            (endDate && item.date > endDate) ||
            (categoryFilter && item.category !== categoryFilter)) return;

        filteredGallery.push({ ...item, originalIndex: index });

        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <img src="${item.image}" onclick="openImageModal(${filteredGallery.length - 1})" />
          <div class="info">
            <p><strong>Note:</strong> ${item.note}</p>
            <p><strong>Category:</strong> ${item.category}</p>
            <p><strong>Date:</strong> ${item.date}</p>
            <div class="actions">
              <button class="edit-btn" onclick="editNote(${index})">Edit</button>
              <button class="delete-btn" onclick="deleteImage(${index})">Delete</button>
            </div>
          </div>
        `;
        galleryContainer.appendChild(card);
      });
    }

    function openImageModal(index) {
      currentIndex = index;
      document.getElementById("imageModal").style.display = "block";
      document.getElementById("modalImage").src = filteredGallery[currentIndex].image;
    }

    function closeImageModal() {
      document.getElementById("imageModal").style.display = "none";
    }

    function nextImage(e) {
      e.stopPropagation();
      if (currentIndex < filteredGallery.length - 1) {
        currentIndex++;
        document.getElementById("modalImage").src = filteredGallery[currentIndex].image;
      }
    }

    function prevImage(e) {
      e.stopPropagation();
      if (currentIndex > 0) {
        currentIndex--;
        document.getElementById("modalImage").src = filteredGallery[currentIndex].image;
      }
    }

    document.addEventListener("keydown", function(e) {
      if (document.getElementById("imageModal").style.display === "block") {
        if (e.key === "ArrowRight") nextImage(e);
        if (e.key === "ArrowLeft") prevImage(e);
        if (e.key === "Escape") closeImageModal();
      }
    });

    async function exportToPDF() {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();

      for (let i = 0; i < gallery.length; i++) {
        const item = gallery[i];
        const img = new Image();
        img.src = item.image;

        await new Promise(resolve => {
          img.onload = function () {
            const width = 180;
            const height = img.height * (width / img.width);
            pdf.addImage(img, 'JPEG', 15, 20, width, height);
            pdf.setFontSize(12);
            pdf.text(`Note: ${item.note}`, 15, height + 30);
            pdf.text(`Category: ${item.category}`, 15, height + 40);
            pdf.text(`Date: ${item.date}`, 15, height + 50);
            if (i < gallery.length - 1) pdf.addPage();
            resolve();
          };
        });
      }

      pdf.save("Trade_Chart_Gallery.pdf");
    }

    renderGallery();
  </script>
</body>
</html>
