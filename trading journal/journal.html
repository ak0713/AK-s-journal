<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Swing Trade Journal</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to right, #0f2027, #203a43, #2c5364);
      color: #f0f0f0;
      padding: 20px;
      margin: 0;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      background: rgba(30, 30, 30, 0.95);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.8);
    }
    h2 {
      text-align: center;
      color: #00e676;
      font-size: 32px;
      margin-bottom: 20px;
    }
    input, button, select {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border-radius: 8px;
      border: 1px solid #555;
      background: #1e1e1e;
      color: #fff;
      font-size: 14px;
    }
    button {
      background-color: #00e676;
      color: #000;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    button:hover {
      background-color: #00c853;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #444;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #333;
      color: #00e676;
    }
    .summary {
      margin-top: 20px;
      font-weight: 600;
      color: #00e676;
      font-size: 18px;
      text-align: center;
    }
    .chart-container {
      margin-top: 40px;
    }
    .profit { color: #00e676; font-weight: bold; }
    .loss { color: #ef5350; font-weight: bold; }
    #editModal {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    #editModal > div {
      background: #222;
      padding: 30px;
      border-radius: 10px;
      width: 90%;
      max-width: 500px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Swing Trade Journal</h2>

    <input type="number" id="startingCapital" placeholder="Enter Starting Capital (‚Çπ)">
    <button onclick="setStartingCapital()">Set Starting Capital</button>

    <div style="margin-top: 20px;">
      <label>From Date:</label>
      <input type="date" id="fromDate">
      <label>To Date:</label>
      <input type="date" id="toDate">
      <label>Status:</label>
      <select id="statusFilter">
        <option value="All">All</option>
        <option value="Open" selected>Open</option>
        <option value="Closed">Closed</option>
      </select>
      <button onclick="renderTrades()">Apply Filters</button>
    </div>

    <input type="text" id="stock" placeholder="Stock Name">
    <input type="date" id="entryDate">
    <input type="number" id="entryPrice" placeholder="Entry Price">
    <input type="number" id="quantity" placeholder="Quantity">
    <input type="date" id="exitDate">
    <input type="number" id="exitPrice" placeholder="Exit Price">
    <input type="text" id="reason" placeholder="Trade Reason / Setup">
    <button onclick="addTrade()">Add Trade</button>
    <button onclick="exportCSV()">Export CSV</button>

    <table>
      <thead>
        <tr>
          <th>Stock</th><th>Entry</th><th>Price</th><th>Qty</th><th>Exit</th><th>Exit Price</th>
          <th>P&L</th><th>%</th><th>Status</th><th>Actions</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>

    <div class="summary" id="summaryStats"></div>

    <div class="chart-container">
      <canvas id="growthChart" height="150"></canvas>
      <canvas id="pnlChart" height="150" style="margin-top:30px;"></canvas>
      <canvas id="capitalChart" height="150" style="margin-top:30px;"></canvas>
    </div>
  </div>

  <!-- Edit Modal -->
  <div id="editModal">
    <div>
      <h3 style="color:#00e676; text-align:center;">Edit Trade</h3>
      <input type="text" id="editStock" placeholder="Stock Name">
      <input type="date" id="editEntryDate">
      <input type="number" id="editEntryPrice" placeholder="Entry Price">
      <input type="number" id="editQuantity" placeholder="Quantity">
      <input type="date" id="editExitDate">
      <input type="number" id="editExitPrice" placeholder="Exit Price">
      <input type="text" id="editReason" placeholder="Trade Reason">
      <div style="display:flex; gap:10px; margin-top:10px;">
        <button onclick="updateTrade()">Update</button>
        <button onclick="closeEditModal()" style="background:#ef5350; color:#fff;">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    let trades = JSON.parse(localStorage.getItem("swingTrades")) || [];
    let startingCapital = parseFloat(localStorage.getItem("startingCapital")) || 0;
    let editIndex = null;
    document.getElementById("startingCapital").value = startingCapital;

    function setStartingCapital() {
      const cap = parseFloat(document.getElementById("startingCapital").value);
      if (isNaN(cap)) return alert("Enter valid capital");
      startingCapital = cap;
      localStorage.setItem("startingCapital", startingCapital);
      renderTrades();
    }

    function saveTrades() {
      localStorage.setItem("swingTrades", JSON.stringify(trades));
    }

    function calculatePnL(entry, exit, qty) {
      if (!exit || isNaN(exit)) return [0, 0];
      let pnl = (exit - entry) * qty;
      let percent = ((exit - entry) / entry) * 100;
      return [pnl, percent];
    }

    function addTrade() {
      let stock = document.getElementById("stock").value;
      let entryDate = document.getElementById("entryDate").value;
      let entryPrice = parseFloat(document.getElementById("entryPrice").value);
      let quantity = parseInt(document.getElementById("quantity").value);
      let exitDate = document.getElementById("exitDate").value;
      let exitPrice = parseFloat(document.getElementById("exitPrice").value);
      let reason = document.getElementById("reason").value;
      if (!stock || !entryDate || isNaN(entryPrice) || isNaN(quantity)) return alert("Fill required fields");
      trades.push({ stock, entryDate, entryPrice, quantity, exitDate, exitPrice, reason });
      saveTrades(); renderTrades();
    }

    function deleteTrade(i) {
      trades.splice(i, 1);
      saveTrades(); renderTrades();
    }

    function exportCSV() {
      let rows = [["Stock","Entry Date","Entry Price","Qty","Exit Date","Exit Price","P&L","%","Status"]];
      trades.forEach(t => {
        let [pnl, percent] = calculatePnL(t.entryPrice, t.exitPrice, t.quantity);
        rows.push([t.stock,t.entryDate,t.entryPrice,t.quantity,t.exitDate || "-", t.exitPrice || "-", pnl.toFixed(2), percent.toFixed(2), t.exitPrice ? "Closed" : "Open"]);
      });
      let csv = "data:text/csv;charset=utf-8," + rows.map(r => r.join(",")).join("\n");
      let link = document.createElement("a");
      link.setAttribute("href", encodeURI(csv));
      link.setAttribute("download", "swing_trades.csv");
      document.body.appendChild(link);
      link.click(); document.body.removeChild(link);
    }

    function renderTrades() {
      const tbody = document.getElementById("tableBody");
      tbody.innerHTML = "";
      const fromDate = document.getElementById("fromDate").value;
      const toDate = document.getElementById("toDate").value;
      const statusFilter = document.getElementById("statusFilter").value;
      let totalPnL = 0, capital = startingCapital;
      let pnlHistory = [], capitalHistory = [capital];
      const filteredTrades = trades.filter(t => {
        const entry = new Date(t.entryDate);
        const from = fromDate ? new Date(fromDate) : null;
        const to = toDate ? new Date(toDate) : null;
        const isStatusMatch =
          statusFilter === "All" ||
          (statusFilter === "Open" && (!t.exitPrice || isNaN(t.exitPrice))) ||
          (statusFilter === "Closed" && t.exitPrice && !isNaN(t.exitPrice));
        const isDateInRange = (!from || entry >= from) && (!to || entry <= to);
        return isStatusMatch && isDateInRange;
      });
      filteredTrades.forEach((t, i) => {
        let [pnl, percent] = calculatePnL(t.entryPrice, t.exitPrice, t.quantity);
        let status = t.exitPrice && !isNaN(t.exitPrice) ? "Closed" : "Open";
        if (status === "Closed" && !isNaN(pnl)) {
          totalPnL += pnl;
          capital += pnl;
          pnlHistory.push(pnl.toFixed(2));
          capitalHistory.push(capital.toFixed(2));
        } else {
          pnlHistory.push(0);
          capitalHistory.push(capital.toFixed(2));
        }
        let row = `<tr>
          <td>${t.stock}</td><td>${t.entryDate}</td><td>${t.entryPrice}</td><td>${t.quantity}</td>
          <td>${t.exitDate || "-"}</td><td>${t.exitPrice || "-"}</td>
          <td class="${pnl >= 0 ? 'profit' : 'loss'}">${pnl.toFixed(2)}</td>
          <td>${percent.toFixed(2)}%</td><td>${status}</td>
          <td>
            <button onclick="openEditModal(${trades.indexOf(t)})">‚úèÔ∏è</button>
            <button onclick="deleteTrade(${trades.indexOf(t)})">üóëÔ∏è</button>
          </td>
        </tr>`;
        tbody.innerHTML += row;
      });
      document.getElementById("summaryStats").innerText =
        `Filtered Trades: ${filteredTrades.length} | P&L: ‚Çπ${totalPnL.toFixed(2)} | Capital: ‚Çπ${capital.toFixed(2)}`;
      renderCharts(pnlHistory, capitalHistory);
    }

    function renderCharts(pnlData, capitalData) {
      if (window.growthChart instanceof Chart) window.growthChart.destroy();
      if (window.pnlChart instanceof Chart) window.pnlChart.destroy();
      if (window.capitalChart instanceof Chart) window.capitalChart.destroy();
      const labels = capitalData.map((_, i) => `T${i}`);
      window.growthChart = new Chart(document.getElementById("growthChart").getContext("2d"), {
        type: 'line',
        data: { labels, datasets: [{ label: "Capital Growth", data: capitalData, borderColor: "#00e676", backgroundColor: "rgba(0,230,118,0.1)", fill: true }] },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
      });
      window.pnlChart = new Chart(document.getElementById("pnlChart").getContext("2d"), {
        type: 'bar',
        data: { labels: labels.slice(1), datasets: [{ label: "P&L", data: pnlData, backgroundColor: pnlData.map(p => p >= 0 ? "#00e676" : "#ef5350") }] },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
      });
      window.capitalChart = new Chart(document.getElementById("capitalChart").getContext("2d"), {
        type: 'line',
        data: { labels, datasets: [{ label: "Capital", data: capitalData, borderColor: "#42a5f5", backgroundColor: "rgba(66,165,245,0.1)", fill: true }] },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
      });
    }

    function openEditModal(index) {
      const t = trades[index];
      editIndex = index;
      document.getElementById("editStock").value = t.stock;
      document.getElementById("editEntryDate").value = t.entryDate;
      document.getElementById("editEntryPrice").value = t.entryPrice;
      document.getElementById("editQuantity").value = t.quantity;
      document.getElementById("editExitDate").value = t.exitDate || '';
      document.getElementById("editExitPrice").value = t.exitPrice || '';
      document.getElementById("editReason").value = t.reason || '';
      document.getElementById("editModal").style.display = "flex";
    }

    function closeEditModal() {
      document.getElementById("editModal").style.display = "none";
    }

    function updateTrade() {
      if (editIndex === null) return;
      const stock = document.getElementById("editStock").value;
      const entryDate = document.getElementById("editEntryDate").value;
      const entryPrice = parseFloat(document.getElementById("editEntryPrice").value);
      const quantity = parseInt(document.getElementById("editQuantity").value);
      const exitDate = document.getElementById("editExitDate").value;
      const exitPrice = parseFloat(document.getElementById("editExitPrice").value);
      const reason = document.getElementById("editReason").value;
      if (!stock || !entryDate || isNaN(entryPrice) || isNaN(quantity)) {
        alert("Please fill required fields."); return;
      }
      trades[editIndex] = { stock, entryDate, entryPrice, quantity, exitDate, exitPrice, reason };
      saveTrades(); closeEditModal(); renderTrades();
    }

    window.onload = () => {
      document.getElementById("statusFilter").value = "Open";
      renderTrades();
    };
  </script>
</body>
</html>
